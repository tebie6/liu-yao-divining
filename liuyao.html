<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>六爻占卜</title>
  <style>
    /* 添加样式 */
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      background-color: #fff;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    .input-container {
      text-align: center;
      margin: 20px 0;
    }
    .input-container textarea {
      width: 100%;
      height: 100px;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      box-sizing: border-box;
    }
    .hexagram {
      text-align: center;
      margin: 20px;
      font-family: 'Courier New', monospace;
    }
    .explanation {
      margin-top: 30px;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>六爻占卜</h1>
  <div class="input-container">
    <textarea id="wishInput" placeholder="在这里输入您的心愿"></textarea>
    <button id="wishInputButton" onclick="startDivination()">开始占卜</button>
  </div>
  <div id="hexagram" class="hexagram">
    <!-- 卦象文本将在这里显示 -->
  </div>
  <div id="explanation" class="explanation">
    <!-- 卦名将在这里显示 -->
  </div>
  <div>
    <br/>
    可以通过 ChatGPT <a href="https://chat.openai.com/g/g-bY96CC9QL-liu-yao-jie-du">六爻解读</a>
    或使用 <a href="https://yiyan.baidu.com/">文心一言</a> 解读内容
    <br/>
    <a target="_blank" href="https://github.com/tebie6/liu-yao-divining">GitHub项目</a>
  </div>
</div>

<script>
  var guaDict = {
    "乾乾": {
      "number": "1",
      "name": "乾卦",
      "des": "乾为天（乾卦）自强不息",
      "sentence": "困龙得水好运交，不由喜气上眉梢，一切谋望皆如意，向后时运渐渐高"
    },
    "坤坤": {
      "number": "2",
      "name": "坤卦",
      "des": "坤为地（坤卦）厚德载物",
      "sentence": "肥羊失群入山岗，饿虎逢之把口张，适口充肠心欢喜，卦若占之大吉昌"
    },
    "震坎": {
      "number": "3",
      "name": "屯卦",
      "des": "水雷屯（屯卦）起始维艰",
      "sentence": "风刮乱丝不见头，颠三倒四犯忧愁，慢从款来左顺遂，急促反惹不自由"
    },
    "坎艮": {
      "number": "4",
      "name": "蒙卦",
      "des": "山水蒙（蒙卦）启蒙奋发",
      "sentence": "卦中爻象犯小耗，君子占之运不高，婚姻合伙有琐碎，做事必然受苦劳"
    },
    "乾坎": {
      "number": "5",
      "name": "需卦",
      "des": "水天需（需卦）守正待机",
      "sentence": "明珠土埋日久深，无光无亮到如今，忽然大风吹土去，自然显露有重新"
    },
    "坎乾": {
      "number": "6",
      "name": "讼卦",
      "des": "天水讼（讼卦）慎争戒讼",
      "sentence": "心中有事事难做，恰是二人争路走，雨下俱是要占先，谁肯让谁走一步"
    },
    "坎坤": {
      "number": "7",
      "name": "师卦",
      "des": "地水师（师卦）行险而顺",
      "sentence": "将帅领旨去出征，骑着烈马拉硬弓，百步穿杨去得准，箭中金钱喜气生"
    },
    "坤坎": {
      "number": "8",
      "name": "比卦",
      "des": "水地比（比卦）诚信团结",
      "sentence": "顺风行船撒起帆，上天又助一蓬风，不用费力逍遥去，任意而行大亨通"
    },
    "乾巽": {
      "number": "9",
      "name": "小畜卦",
      "des": "风天小畜（小畜卦）蓄养待进",
      "sentence": "苗逢旱天尽焦梢，水想云浓雨不浇，农人仰面长吁气，是从款来莫心高"
    },
    "兑乾": {
      "number": "10",
      "name": "履卦",
      "des": "天泽履（履卦）脚踏实地",
      "sentence": "凤凰落在西岐山，长鸣几声出圣贤，天降文王开基业，富贵荣华八百年"
    },
    "乾坤": {
      "number": "11",
      "name": "泰卦",
      "des": "地天泰（泰卦）应时而变",
      "sentence": "学文满腹入场闱，三元及第得意回，从今解去愁和闷，喜庆平地一声雷"
    },
    "坤乾": {
      "number": "12",
      "name": "否卦",
      "des": "天地否（否卦）不交不通",
      "sentence": "虎落陷坑不堪言，进前容易退后难，谋望不遂自己便，疾病口舌事牵连"
    },
    "离乾": {
      "number": "13",
      "name": "同人卦",
      "des": "天火同人（同人卦）上下和同",
      "sentence": "心中有事犯猜疑，谋望从前不着实，幸遇明人来指引，诸般忧闷自消之"
    },
    "乾离": {
      "number": "14",
      "name": "大有卦",
      "des": "火天大有（大有卦）顺天依时",
      "sentence": "砍树摸雀作事牢，是非口舌自然消，婚姻合伙不费力，若问走失未逃脱"
    },
    "艮坤": {
      "number": "15",
      "name": "谦卦",
      "des": "地山谦（谦卦）内高外低",
      "sentence": "天赐贫人一封金，不争不抢两平分，彼此分得金到手，一切谋望皆遂心"
    },
    "坤震": {
      "number": "16",
      "name": "豫卦",
      "des": "雷地豫（豫卦）顺时依势",
      "sentence": "太公插下杏黄旗，收妖为徒归西岐，自此青龙得了位，一旦谋望百事宜"
    },
    "震兑": {
      "number": "17",
      "name": "随卦",
      "des": "泽雷随（随卦）随时变通",
      "sentence": "泥里步踏这几年，推车靠崖在眼前，目下就该再使力，扒上崖去发财源"
    },
    "巽艮": {
      "number": "18",
      "name": "蛊卦",
      "des": "山风蛊（蛊卦）振疲起衰",
      "sentence": "卦中爻象如推磨，顺当为福反为祸，心中有益且迟迟，凡事尽从忙处错"
    },
    "兑坤": {
      "number": "19",
      "name": "临卦",
      "des": "地泽临（临卦）教民保民",
      "sentence": "君王无道民倒悬，常想拨云见青天，幸逢明主施仁政，重又安居乐自然"
    },
    "坤巽": {
      "number": "20",
      "name": "观卦",
      "des": "风地观（观卦）观下瞻上",
      "sentence": "卦遇蓬花旱逢河，生意买卖利息多，婚姻自有人来助，出门永不受折磨"
    },
    "震离": {
      "number": "21",
      "name": "噬嗑卦",
      "des": "火雷噬嗑（噬嗑卦）刚柔相济",
      "sentence": "运拙如同身受饥，幸得送饭又送食，适口充腹心欢喜，忧愁从此渐消移"
    },
    "离艮": {
      "number": "22",
      "name": "贲卦",
      "des": "山火贲（贲卦）饰外扬质",
      "sentence": "近来运转瑞气周，窈窕淑女君子求。钟鼓乐之大吉庆，占者逢之喜临头"
    },
    "坤艮": {
      "number": "23",
      "name": "剥卦",
      "des": "山地剥（剥卦）顺势而止",
      "sentence": "鹊遇天晚宿林中，不知林内先有鹰，虽然同处心生恶，卦若逢之是非轻"
    },
    "震坤": {
      "number": "24",
      "name": "复卦",
      "des": "地雷复（复卦）寓动于顺",
      "sentence": "马氏太公不相合，世人占之忧疑多，恩人无义反为怨，是非平地起风波"
    },
    "震乾": {
      "number": "25",
      "name": "无妄卦",
      "des": "天雷无妄（无妄卦）无妄而得",
      "sentence": "飞鸟失机落笼中，纵然奋飞不能腾，目下只宜守本分，妄想扒高万不能"
    },
    "乾艮": {
      "number": "26",
      "name": "大畜卦",
      "des": "山天大畜（大畜卦）止而不止",
      "sentence": "忧愁常锁两眉头，千头万绪挂心间，从今以后防开阵，任意行而不相干"
    },
    "震艮": {
      "number": "27",
      "name": "颐卦",
      "des": "山雷颐（颐卦）纯正以养",
      "sentence": "太公独钓渭水河，手执丝杆忧愁多，时来又遇文王访，自此永不受折磨"
    },
    "巽兑": {
      "number": "28",
      "name": "大过卦",
      "des": "泽风大过（大过卦）非常行动",
      "sentence": "夜晚梦里梦金银，醒来仍不见一文，目下只宜求本分，思想络是空劳神"
    },
    "坎坎": {
      "number": "29",
      "name": "坎卦",
      "des": "坎为水（坎卦）行险用险",
      "sentence": "一轮明月照水中，只见影儿不见踪，愚夫当财下去取，摸来摸去一场空"
    },
    "离离": {
      "number": "30",
      "name": "离卦",
      "des": "离为火（离卦）附和依托",
      "sentence": "官人来占主高升，庄农人家产业增，生意买卖利息厚，匠艺占之大亨通"
    },
    "艮兑": {
      "number": "31",
      "name": "咸卦",
      "des": "泽山咸（咸卦）相互感应",
      "sentence": "运去黄金失色，时来棒槌发芽，月令极好无差，且喜心宽意大"
    },
    "巽震": {
      "number": "32",
      "name": "恒卦",
      "des": "雷风恒（恒卦）恒心有成",
      "sentence": "渔翁寻鱼运气好，鱼来撞网跑不了，别人使本挣不来，谁想一到就凑合"
    },
    "艮乾": {
      "number": "33",
      "name": "遁卦",
      "des": "天山遁（遁卦）遁世救世",
      "sentence": "浓云蔽日不光明，劝君且莫出远行，婚姻求财皆不利，提防口舌到门庭"
    },
    "乾震": {
      "number": "34",
      "name": "大壮卦",
      "des": "雷天大壮（大壮卦）壮勿妄动",
      "sentence": "卦占工师得大木，眼前该着走上路，时来运转多顺当，有事自管放心宽"
    },
    "坤离": {
      "number": "35",
      "name": "晋卦",
      "des": "火地晋（晋卦）求进发展",
      "sentence": "锄地锄去苗里草，谁想财帛将人找，一锄锄出银子来，这个运气也算好"
    },
    "离坤": {
      "number": "36",
      "name": "明夷卦",
      "des": "地火明夷（明夷卦）晦而转明",
      "sentence": "时乖运拙走不着，急忙过河拆了桥，恩人无义反为怨，凡事无功枉受劳"
    },
    "离巽": {
      "number": "37",
      "name": "家人卦",
      "des": "风火家人（家人卦）诚威治业",
      "sentence": "一朵鲜花镜中开，看着极好取不来，劝君休把镜花恋，卦若逢之主可怪"
    },
    "兑离": {
      "number": "38",
      "name": "睽卦",
      "des": "火泽睽（睽卦）异中求同",
      "sentence": "此卦占来运气歹，如同太公作买卖，贩猪牛快贩羊迟，猪羊齐贩断了宰"
    },
    "艮坎": {
      "number": "39",
      "name": "蹇卦",
      "des": "水山蹇（蹇卦）险阻在前",
      "sentence": "大雨倾地雪满天，路上行人苦又寒，拖泥带水费尽力，事不遂心且耐烦"
    },
    "坎震": {
      "number": "40",
      "name": "解卦",
      "des": "雷水解（解卦）柔道致治",
      "sentence": "目下月令如过关，千辛万苦受熬煎，时来恰相有人救，任意所为不相干"
    },
    "兑艮": {
      "number": "41",
      "name": "损卦",
      "des": "山泽损（损卦）损益制衡",
      "sentence": "时运不至费心多，比作推车受折磨，山路崎岖吊下耳，左插右按按不着"
    },
    "震巽": {
      "number": "42",
      "name": "益卦",
      "des": "风雷益（益卦）损上益下",
      "sentence": "时来运转吉气发，多年枯木又开花，枝叶重生多茂盛，几人见了几人夸"
    },
    "乾兑": {
      "number": "43",
      "name": "夬卦",
      "des": "泽天夬（夬卦）决而能和",
      "sentence": "蜘蛛脱网赛天军，粘住游蜂翅翎毛，幸有大风吹破网，脱离灾难又逍遥"
    },
    "巽乾": {
      "number": "44",
      "name": "姤卦",
      "des": "天风姤（姤卦）天下有风",
      "sentence": "他乡遇友喜气欢，须知运气福重添，自今交了顺当运，向后管保不相干"
    },
    "坤兑": {
      "number": "45",
      "name": "萃卦",
      "des": "泽地萃（萃卦）荟萃聚集",
      "sentence": "游鱼戏水被网惊，跳过龙门身化龙，三尺杨柳垂金线，万朵桃花显你能"
    },
    "巽坤": {
      "number": "46",
      "name": "升卦",
      "des": "地泽临（临卦）柔顺谦虚",
      "sentence": "士人来占必得名，生意买卖也兴隆，匠艺逢之交易好，农间庄稼亦收成"
    },
    "坎兑": {
      "number": "47",
      "name": "困卦",
      "des": "泽水困（困卦）困境求通",
      "sentence": "时运不来好伤怀，撮上押去把梯抬，一筒虫翼无到手，转了上去下不来"
    },
    "巽坎": {
      "number": "48",
      "name": "井卦",
      "des": "水风井（井卦）求贤若渴",
      "sentence": "枯井破费已多年，一朝流泉出来鲜，资生济渴人称羡，时来运转喜自然"
    },
    "离兑": {
      "number": "49",
      "name": "革卦",
      "des": "泽火革（革卦）顺天应人",
      "sentence": "苗逢旱天渐渐衰，幸得天恩降雨来，忧去喜来能变化，求谋干事遂心怀"
    },
    "巽离": {
      "number": "50",
      "name": "鼎卦",
      "des": "火风鼎（鼎卦）稳重图变",
      "sentence": "莺鹜蛤蜊落沙滩，蛤蜊莺鹜两翅扇，渔人进前双得利，失走行人却自在"
    },
    "震震": {
      "number": "51",
      "name": "震卦",
      "des": "震为雷（震卦）临危不乱",
      "sentence": "一口金钟在淤泥，人人拿着当玩石，忽然一日钟悬起，响亮一声天下知"
    },
    "艮艮": {
      "number": "52",
      "name": "艮卦",
      "des": "艮为山（艮卦）动静适时",
      "sentence": "财帛常打心头走，可惜眼前难到手，不如意时且忍耐，逢着闲事休开口"
    },
    "艮巽": {
      "number": "53",
      "name": "渐卦",
      "des": "风山渐（渐卦）渐进蓄德",
      "sentence": "俊鸟幸得出笼中，脱离灾难显威风，一朝得意福力至，东西南北任意行"
    },
    "兑震": {
      "number": "54",
      "name": "归妹卦",
      "des": "雷泽归妹（归妹卦）立家兴业",
      "sentence": "求鱼须当向水中，树上求之不顺情，受尽爬揭难随意，劳而无功运平平"
    },
    "离震": {
      "number": "55",
      "name": "丰卦",
      "des": "雷火丰（丰卦）日中则斜",
      "sentence": "古镜昏暗好几年，一朝磨明似月圆，君子谋事逢此卦，时来运转喜自然"
    },
    "艮离": {
      "number": "56",
      "name": "旅卦",
      "des": "火山旅（旅卦）依义顺时",
      "sentence": "飞鸟树上垒窝巢，小人使计举火烧，君占此卦为不吉，一切谋望枉徒劳"
    },
    "巽巽": {
      "number": "57",
      "name": "巽卦",
      "des": "巽为风（巽卦）谦逊受益",
      "sentence": "一叶孤舟落沙滩，有篙无水进退难，时逢大雨江湖溢，不用费力任往返"
    },
    "兑兑": {
      "number": "58",
      "name": "兑卦",
      "des": "兑为泽（兑卦）刚内柔外",
      "sentence": "这个卦象真可取，觉着做事不费力，休要错过这机关，事事觉得随心意"
    },
    "坎巽": {
      "number": "59",
      "name": "涣卦",
      "des": "风水涣（涣卦）拯救涣散",
      "sentence": "隔河望见一锭金，欲取岸宽水又深，指望资财难到手，昼思夜想枉费心"
    },
    "兑坎": {
      "number": "60",
      "name": "节卦",
      "des": "水泽节（节卦）万物有节",
      "sentence": "时来运转喜气生，登台封神姜太公，到此诸神皆退位，纵然有祸不成凶"
    },
    "兑巽": {
      "number": "61",
      "name": "中孚卦",
      "des": "风泽中孚（中孚卦）诚信立身",
      "sentence": "路上行人色匆匆，急忙无桥过薄冰，小心谨慎过得去，一步错了落水中"
    },
    "艮震": {
      "number": "62",
      "name": "小过卦",
      "des": "雷山小过（小过卦）行动有度",
      "sentence": "行人路过独木桥，心内惶恐眼里瞧，爽利保你过得去，慢行一定不安牢"
    },
    "离坎": {
      "number": "63",
      "name": "既济卦",
      "des": "水火既济（既济卦）盛极将衰",
      "sentence": "金榜以上题姓名，不负当年苦用功，人逢此卦名吉庆，一切谋望大亨通"
    },
    "坎离": {
      "number": "64",
      "name": "未济卦",
      "des": "火水未济（未济卦）事业未竟",
      "sentence": "离地着人几丈深，是防偷营劫寨人，后封太岁为凶煞，时加谨慎祸不侵"
    }
  };

  var guaNames = {
    '阳阳阳': '乾',
    '阴阴阴': '坤',
    '阴阳阳': '兑',
    '阳阴阳': '震',
    '阳阳阴': '巽',
    '阴阳阴': '坎',
    '阳阴阴': '艮',
    '阴阴阳': '离'
  };
  var yaoTexts = ['初爻', '二爻', '三爻', '四爻', '五爻', '上爻']; // 定义六个爻的名称
  var hexagramLines = [];
  var currentLine = 0;
  var wish = "";
  function startDivination() {
    wish = document.getElementById('wishInput').value.trim();
    if (wish === '') {
      alert('请先输入您的心愿，再开始占卜。');
      return;
    }
    document.getElementById('wishInput').style.display = 'none'; // 隐藏输入框
    document.getElementById('wishInputButton').style.display = 'none'; // 隐藏按钮
    castYao(); // 开始占卜每一爻
  }

  function castYao() {
    if (currentLine < 6) {
      var yaoResults = [];
      for (var i = 0; i < 3; i++) {
        yaoResults.push(Math.random() < 0.5 ? '背' : '字');
      }
      var yinYang = yaoResults.filter(x => x === '字').length > 1 ? '阳' : '阴'; // “字”多于一次为阳，否则为阴
      hexagramLines.push(yinYang); // 保存阴阳结果
      var resultText = `${yaoTexts[currentLine]} 为 ${yaoResults.join('')} 为 ${yinYang}`;
      typeWriter(resultText, document.getElementById('hexagram'), function() {
        // 每三爻展示一次结果
        if ((currentLine + 1) % 3 === 0) {
          var part = currentLine < 3 ? '首卦' : '次卦';
          var gua = hexagramLines.slice(currentLine - 2, currentLine + 1).reverse().join('');
          typeWriter(`${part}: ${guaNames[gua]}`, document.getElementById('hexagram'), function() {
            currentLine++;
            castYao(); // 递归调用投下一个爻
          });
        } else {
          currentLine++;
          castYao(); // 递归调用投下一个爻
        }
      });
    } else {
      displayResult();
    }
  }

  function typeWriter(text, target, callback, index = 0) {
    if (index < text.length) {
      target.innerHTML += text[index++];
      setTimeout(function() {
        typeWriter(text, target, callback, index);
      }, 100); // 调整打字速度
    } else {
      target.innerHTML += '<br>'; // 新爻开始前添加换行
      if (typeof callback === "function") callback();
    }
  }

  function displayResult() {
    var primaryGua = hexagramLines.slice(0, 3).reverse().join(''); // 前三爻组成首卦
    var secondaryGua = hexagramLines.slice(3).reverse().join(''); // 后三爻组成次卦
    var guaName = guaNames[primaryGua] + guaNames[secondaryGua];
    var resultText = `六爻结果：${guaName}`;
    typeWriter(`我的心愿是：${wish}`, document.getElementById('explanation'), function() {
      typeWriter(resultText, document.getElementById('explanation'), function() {
        showGuaText(guaName);
      });
    });
  }

  function showGuaText(guaName) {
    var guaText = guaDict[guaName];
    typeWriter(`卦名为：${guaText.name}`, document.getElementById('explanation'), function() {
      typeWriter(`${guaText.des}`, document.getElementById('explanation'), function() {
        typeWriter(`卦辞为：${guaText.sentence}`, document.getElementById('explanation'));
      });
    });
  }
</script>
</body>
</html>
